#!/bin/bash
#/**
#@file     System.lib
#@brief    Librería o clase System
#@class    System
#@brief    Funciones básicas del sistema.
#@version  0.9
#@warning  License: GNU GPLv3+
#*/


#/**
#         ogEcho [loglevel] [position] message...
#@brief   Muestra mensajes en consola y lo registra en fichero de incidencias.
#@arg  \c str_loglevel nivel de registro de incidencias.
#@arg  \c str_position posición del mensaje en pantalla.
#@arg  \c str_message  mensaje (puede recibir más de 1 parámetro.
#@return  Mensaje mostrado.
#@note    Primera versión para OpenGNSys
#@author  Ramon Gomez, ETSII Universidad Sevilla
#@date    2009-07-23
#*/
function ogEcho () {

#/// Variables locales
local LOGLEVEL DATETIME         #/// Variables locales

# Selección del nivel de registro (opcional).
case "$1" in
     info)    tput setf 2; LOGLEVEL=$1; shift ;;
     warning) tput setf 6; LOGLEVEL=$1; shift ;;
     error)   tput setf 8; LOGLEVEL=$1; shift ;;
     *)       tput setf 9;
esac
 
# Selección de la posición en pantalla (opcional).
case "$2" in
     "up-left")       tput cup  0  0; shift ;;
     "up-center")     tput cup  0 40; shift ;;
     "up-right")      tput cup  0 80; shift ;;
     "middle-left")   tput cup 40  0; shift ;;
     "middle-center") tput cup 40 40; shift ;;
     "middle-right")  tput cup 40 80; shift ;;
     "down-left")     tput cup 80  0; shift ;;
     "down-center")   tput cup 80 40; shift ;;
     "down-right")    tput cup 80 80; shift ;;
     *)               ;;
esac

#/// Mostrar mensaje en consola.
DATETIME=$(date +"%F %T")
echo -e "$DATETIME $*"
tput setf 9

#/// Registro de incidencias.
if [ -w "$OGLOGFILE" ]; then
    if [ -z "$LOGLEVEL" ]; then
        echo "$DATETIME $*" >>$OGLOGFILE 
    else
        echo "$DATETIME $LOGLEVEL: $*" >>$OGLOGFILE 
    fi
fi
}


#/**
#         ogRaiseError errcode ["errmessage" ...]
#@brief   Devuelve el mensaje y el código de error correspondiente.
#@arg  \c int_errcode    código de error.
#@arg  \c str_errmessage mensajes complementarios de error.
#@return  Mensaje de error.
#@warning No definidas
#@note    Primera versión para OpenGNSys
#@author  Ramon Gomez, ETSII Universidad Sevilla
#@date    2009-07-21
#*/ 
function ogRaiseError () {

#/// En pruebas.
local MSG CODE

CODE=$1
case "$CODE" in
     $OG_ERR_FORMAT)
        MSG="$MSG_ERR_FORMAT"
        [ -n "$2" ] && MSG="$MSG\n\t$MSG_FORMAT: $2"
        [ -n "$3" ] && MSG="$MSG\n\t$MSG_EXAMPLE: $3"
        ;;
     $OG_ERR_NOTFOUND)	MSG="$MSG_ERR_NOTFOUND \"$2\"" ;;
     *)			MSG="$MSG_ERR_GENERIC"; CODE=$OG_ERR_GENERIC ;;
esac

ogEcho error "${FUNCNAME[${#FUNCNAME[*]}-1]}: $MSG" >&2
return $CODE
}


