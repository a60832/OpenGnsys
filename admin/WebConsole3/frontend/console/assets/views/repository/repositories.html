<section class="content-header">
  <h1 translate="repositories">
  </h1>
  <ol class="breadcrumb">
    <li><a ui-sref="app.dashboard"><i class="fa fa-dashboard"></i> {{'dashboard'|translate}}</a></li>
    <li class="active" translate="repositories"></li>
  </ol>
</section>
<section fixed-toolboxbar class="toolboxbar">
	<div >
		<div class="col-md-12">
			<div class="input-group">
		      <input type="text" name="q" class="form-control" placeholder="Search..." ng-model="searchText">
		          <span class="input-group-btn">
		            <button type="button" name="search" id="search-btn" class="btn btn-flat"><i class="fa fa-search"></i>
		            </button>
		          </span>
		    </div>
		</div>
		<div class="col-md-12" style="margin-top: 5px;margin-bottom: 5px;">
			<div class="box-tools pull-right">
				<button class="btn btn-default" ng-click="vm.newRepository()" translate="new_repo"></button>
			</div>
		</div>
	</div>
</section>
<section class="content">
	<div class="row">
		<div ng-repeat="repository in vm.repositories"  class="col-md-6">
			<div class="box box-primary">
		        <div class="box-header with-border">
		        	<i class="fa  fa-server"></i>
		          <h3 class="box-title">{{repository.name}}</h3>
		          <div class="box-tools pull-right">
	                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
	                </button>
	                 <button type="button" class="btn btn-box-tool" ng-click="vm.deleteRepository(repository)"><i class="fa fa-times"></i>
	                </button>
	              </div>
		        </div>
		        <div class="box-body">
		         	<form role="form" gbn-auto-form name="Form" form-options="vm.formOptions" form-model="repository"></form>
					<div class="box-footer">
			        	<button type="button" class="btn btn-primary" translate="save" ng-click="vm.saveRepository(Form, repository)"></button>
			        	<button type="button" ng-disabled="repository.apikey.length == 0" class="btn btn-primary pull-right"  ng-click="vm.refreshRepoInfo(repository)">
			        		<i class="fa fa-refresh"></i> <span translate="refresh_info"></span>
			        	</button>
			        </div>      	
		        </div>
		        <div class="box-footer">
					<div class="box collapsed-box">
			            <div class="box-header">
			              <div class="">
			              	<h3 class="box-title" translate="filesystem_info"></h3>
			              	<button class="btn btn-box-tool" data-widget="collapse" ><i class="fa fa-plus"></i></button>
			              </div>
			            </div>
			            <!-- /.box-header -->
			            <div class="box-body no-padding" ng-init="vm.refreshRepoInfo(repository)">
			            	<div translate="connection_not_available" ng-if="!repository.info"></div>
							<table class="table table-condensed table-striped" ng-if="repository.info">
								<tbody>
									<tr>
										<th colspan="5" translate="disk_info"></th>
									</tr>
									<tr>
										<th translate="partition"></th>
										<th translate="total_disk"></th>
										<th translate="used_disk"></th>
										<th translate="free_disk"></th>
										<th translate="busy_percent_disk"></th>
									</tr>
									<tr>
										<td>{{repository.info.disk[0].partition}}</td>
										<td>{{repository.info.disk[0].total}}</td>
						 				<td>{{repository.info.disk[0].used}}</td>
										<td>
											{{repository.info.disk[0].free}}
										</td>
										<td>
											<span class="badge" ng-class="{'bg-green': repository.info.disk[0].percent.split('%')[0] < 60, 'bg-red': repository.info.disk[0].percent.split('%')[0] > 85, 'bg-yellow': repository.info.disk[0].percent.split('%')[0] >= 60 && repository.info.disk[0].percent.split('%')[0] <= 85}">{{repository.info.disk[0].percent}}
											</span>
										</td>
									</tr>
								</tbody>
								<tbody>
									<tr>
										<th colspan="2" translate="images_info"></th>
									</tr>
									<tr>
										<th translate="name"></th>
										<th translate="size"></th>
										<th translate="delete"></th>
									</tr>
								</tbody>
								<tbody ng-repeat="fileGroup in repository.info.files">
									<tr ng-repeat="file in fileGroup | orderBy: 'name'">
										<td>{{file.name}}</td>
						 				<td>{{OGCommonService.getUnits(file.size)}}</td>
						 				<td>
						 					<a ng-if="vm.isImageFile(file)" class="btn btn-danger" href="javascript:void(0)" translate="delete" ng-click="vm.deleteImageFile(file)"></a>
						 				</td>
									</tr>
								</tbody>
							</table>
			            </div>
			            <!-- /.box-body -->
			          </div>
		        </div>
		        <!-- /.box-body -->
		        <!-- Loading (remove the following to stop the loading)-->
		        <div class="overlay" ng-if="repository.$$loading">
		          <i class="fa fa-refresh fa-spin"></i>
		        </div>
		        <!-- end loading -->
		      </div>
	      </div>
	</div>
</section>