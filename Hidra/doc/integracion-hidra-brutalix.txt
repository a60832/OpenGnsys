	Cómo integrar Hidra con Brutalix
	--------------------------------


1. Introducción.

El programa "hidrac" y los scripts deben copiarse a la distribución Linux que se enviará al cliente en el proceso de arranque por PXE.

Actualmente se está usando la distribución Ping-Brutal del Proyecto Brutalix como base de trabajo (ver https://forja.rediris.es/projects/brutalixl/).

Ping-Brutal incluye un núcleo Linux versión 2.6 (kernel) y una imagen de arranque (initrd) que se carga en memoria al encender el ordenador. Este fichero "initrd" incluyo un archivo comprimido (rootfs.tar.bz2) con el contenido del sistema operativo que se utilizará para la ejecución de los comandos de Hidra.


2. Extracción inicial.

Extraer "kernel" e "initrd" de la imagen ISO de la distribución y copiarlos en el directorio de arranque (ejecutar como root):

	mount -o loop ping-brutal-XXX.iso DirTemporal
	cp DirTemporal/kernel /usr/local/hidra/boot/kernel
	cp DirTemporal/initrd.gz /usr/local/hidra/boot/initrd
	umount DirTemporal

Si el desarrollador piensa realizar varios cambios en el arranque del cliente, puede ser interesante conservar en un directorio independiente el contenido descomprimido del fichero rootfs.tar.bz2, ejecutando:

	mount -o loop /usr/local/hidra/boot/initrd DirTemporal
	mkdir DirRootfs
	cd DirRootfs
	tar xpvjf DirTemporal/rootfs.tar.bz2
	umount DirTemporal


3. Modificar el sistema de arranque.

Debe modificarse la imagen descomprimida del sistema operativo, para incluir los ficheros necesarios para el cliente Hidra.

ATENCIÓN: A la hora de ejecutar las siguientes órdenes, tener en cuenta que todos los caminos que hacen referencia al directorio donde se ha descomprimido "rootfs" son relativos.

	cd DirRootfs
	mkdir -p usr/local/hidra/scripts
	cp FuentesHidra/hidrac/hidrac usr/local/hidra
	cp FuentesHidra/scripts/* usr/local/hidra/scripts
	cp FuentesHidra/init.d/hidrac etc/init.d/hidrac

Hay varias formas de iniciar el cliente Hidra en el proceso de arranque del sistema.

- Modificar etc/inittab sustuyendo la línea de la tty1 por:
	1:2345:respawn:/etc/init.d/hidrac start
- Crear un enlace simbólico para ejecutarlo en el arranque normal:
	ln -s /etc/init.d/hidrac etc/rc.d/rc3.d

Si se van a ejecutar los scripts "a mano", hay que editar el fichero root/.bash_profile para incluir el directorio /usr/local/hidra/scripts en el PATH del usuario root.


4. Regenerar la imagen de arranque.

Una vez realizados los cambios en el sistema, hay que regenerar la imagen de arranque, ejecutando:

	mount -o loop /usr/local/hidra/boot/initrd DirTemporal
	cd DirRootfs
	tar cpvjf DirTemporal/rootfs.tar.bz2 *
	umount DirTemporal

	
(continuar...)

